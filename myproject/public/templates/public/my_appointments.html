{% extends 'public/P_base.html' %}
{% load static %}
{% block title %}My Appointments{% endblock %}
{% block content %}
  <!-- Upcoming Appointments -->
  <h2 class="page-title">
    <img src="{% static 'icons/upcoming.png' %}" alt="Upcoming" style="width: 20px; height: 20px;">
    Upcoming Appointments
  </h2>
  <section class="section">
    <div class="section-body">
      {% if upcoming_appointments %}
        {% for appointment in upcoming_appointments %}
        <div class="appointment">
          <img src="{% url 'sysadmin:profile_picture' appointment.counselor.id %}" 
               alt="Profile" 
               class="counselor-avatar" 
               onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
          <div class="counselor-avatar-default" style="display: none;">
            <span class="avatar-text">{{ appointment.counselor.first_name|first|default:appointment.counselor.username|first|upper }}</span>
          </div>
          <div class="client">
            <h4>{{ appointment.counselor.get_full_name|default:appointment.counselor.username }}</h4>
            <p>{{ appointment.counselor_title }}</p>
            <p class="appointment-status status-{{ appointment.status }}">{{ appointment.status|title }}</p>
          </div>
          <div class="actions">
            <span class="pill">
              {{ appointment.timeslot.start_time|time:"g:i A" }} - {{ appointment.timeslot.date|date:"M d, Y" }}
            </span>
            <div class="appointment-actions">
              {% if appointment.status == 'pending' or appointment.status == 'confirmed' %}
                <form method="post" action="{% url 'public:cancel_appointment' appointment.id %}" style="display: inline;">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to cancel this appointment?')">Cancel</button>
                </form>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="no-appointments">
          <div class="no-appointments-icon">
            <img src="{% static 'icons/empty.gif' %}" alt="No Appointments" style="width: 80px; height: 80px;">
          </div>
          <h3>No Upcoming Appointments</h3>
          <p>You don't have any upcoming appointments scheduled.</p>
        </div>
      {% endif %}
    </div>
  </section>

  <!-- Past Appointments -->
  <h2 class="page-title">
    <img src="{% static 'icons/past.png' %}" alt="Past" style="width: 20px; height: 20px;">
    Past Appointments
  </h2>
  <section class="section">
    <div class="section-body">
      {% if past_appointments %}
        {% for appointment in past_appointments %}
        <div class="appointment past">
          <img src="{% url 'sysadmin:profile_picture' appointment.counselor.id %}" 
               alt="Profile" 
               class="counselor-avatar" 
               onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
          <div class="counselor-avatar-default" style="display: none;">
            <span class="avatar-text">{{ appointment.counselor.first_name|first|default:appointment.counselor.username|first|upper }}</span>
          </div>
          <div class="client">
            <h4>{{ appointment.counselor.get_full_name|default:appointment.counselor.username }}</h4>
            <p>{{ appointment.counselor_title }}</p>
            <p class="appointment-status status-{{ appointment.status }}">{{ appointment.status|title }}</p>
          </div>
          <div class="actions">
            <span class="pill status-{{ appointment.status }}">
              {% if appointment.status == 'completed' %}
                Completed
              {% elif appointment.status == 'cancelled' %}
                Cancelled
              {% else %}
                {{ appointment.status|title }}
              {% endif %}
            </span>
            <span class="appointment-date">
              {{ appointment.timeslot.start_time|time:"g:i A" }} - {{ appointment.timeslot.date|date:"M d, Y" }}
            </span>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="no-appointments">
          <div class="no-appointments-icon">ðŸ“š</div>
          <h3>No Past Appointments</h3>
          <p>You don't have any past appointments yet.</p>
        </div>
      {% endif %}
    </div>
  </section>

  <style>
    .page-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-dark);
      margin: 20px 0 16px 0;
      padding: 0 20px;
    }

    .section {
      background: var(--white);
      border: 2px solid var(--dark-green);
      border-radius: 8px;
      box-shadow: var(--shadow);
      margin: 0 20px 24px 20px;
      overflow: hidden;
    }

    .section-body {
      padding: 16px;
    }

    .appointment {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      margin-bottom: 12px;
      background: var(--white);
      border: 2px solid var(--dark-green);
      border-radius: 8px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }

    .appointment:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .appointment.past {
      opacity: 0.85;
      background: #f8f9fa;
    }

    .counselor-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--dark-green);
      flex-shrink: 0;
    }

    .counselor-avatar-default {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--accent-yellow);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid var(--dark-green);
      flex-shrink: 0;
    }

    .avatar-text {
      color: var(--dark-gray);
      font-weight: 600;
      font-size: 1.2rem;
    }

    .client {
      flex: 1;
      min-width: 0;
    }

    .client h4 {
      margin: 0 0 4px 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .client p {
      margin: 0 0 4px 0;
      font-size: 0.9rem;
      color: var(--text-dark);
      opacity: 0.8;
    }

    .appointment-status {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 3px 8px;
      border-radius: 4px;
      display: inline-block;
      margin-top: 4px;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-confirmed {
      background: #d4edda;
      color: #155724;
    }

    .status-cancelled {
      background: #f8d7da;
      color: #721c24;
    }

    .status-completed {
      background: #d1ecf1;
      color: #0c5460;
    }

    .actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }

    .pill {
      background: var(--light-gray);
      color: var(--text-dark);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
      white-space: nowrap;
    }

    .pill.status-completed {
      background: #d1ecf1;
      color: #0c5460;
    }

    .pill.status-cancelled {
      background: #f8d7da;
      color: #721c24;
    }

    .appointment-date {
      color: var(--text-dark);
      font-size: 0.8rem;
      font-weight: 500;
      opacity: 0.8;
    }

    .appointment-actions {
      display: flex;
      gap: 6px;
    }

    .btn {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-danger {
      background: var(--orange);
      color: var(--white);
    }

    .btn-danger:hover {
      background: #e55a2b;
    }

    .no-appointments {
      text-align: center;
      padding: 40px 20px;
      background: var(--white);
      border: 2px solid var(--dark-green);
      border-radius: 8px;
      box-shadow: var(--shadow);
    }

    .no-appointments-icon {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.6;
      color: var(--dark-green);
    }

    .no-appointments h3 {
      color: var(--text-dark);
      margin-bottom: 12px;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .no-appointments p {
      color: var(--text-dark);
      margin: 0;
      font-size: 0.9rem;
      opacity: 0.8;
    }

    @media (max-width: 768px) {
      .page-title {
        font-size: 1.3rem;
        padding: 0 15px;
      }

      .section {
        margin: 0 15px 20px 15px;
      }

      .section-body {
        padding: 12px;
      }

      .appointment {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
        padding: 12px;
      }

      .counselor-avatar,
      .counselor-avatar-default {
        width: 45px;
        height: 45px;
      }

      .avatar-text {
        font-size: 1rem;
      }

      .client h4 {
        font-size: 1rem;
      }

      .client p {
        font-size: 0.85rem;
      }

      .actions {
        width: 100%;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }

      .appointment-actions {
        width: 100%;
        justify-content: flex-end;
      }

      .btn {
        padding: 6px 10px;
        font-size: 0.8rem;
      }
    }

    @media (max-width: 480px) {
      .page-title {
        font-size: 1.2rem;
        padding: 0 12px;
      }

      .section {
        margin: 0 12px 16px 12px;
      }

      .section-body {
        padding: 10px;
      }

      .appointment {
        padding: 10px;
        gap: 10px;
      }

      .counselor-avatar,
      .counselor-avatar-default {
        width: 40px;
        height: 40px;
      }

      .avatar-text {
        font-size: 0.9rem;
      }

      .client h4 {
        font-size: 0.95rem;
      }

      .client p {
        font-size: 0.8rem;
      }

      .appointment-status {
        font-size: 0.7rem;
        padding: 2px 6px;
      }

      .pill {
        font-size: 0.75rem;
        padding: 4px 10px;
      }

      .appointment-date {
        font-size: 0.75rem;
      }

      .actions {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }

      .appointment-actions {
        width: 100%;
        justify-content: stretch;
      }

      .btn {
        width: 100%;
        padding: 8px;
        font-size: 0.8rem;
      }

      .no-appointments {
        padding: 30px 16px;
      }

      .no-appointments-icon {
        font-size: 2.5rem;
      }

      .no-appointments h3 {
        font-size: 1.1rem;
      }

      .no-appointments p {
        font-size: 0.85rem;
      }
    }
  </style>
{% endblock %}
