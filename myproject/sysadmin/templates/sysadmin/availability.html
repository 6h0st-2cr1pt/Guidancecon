{% extends 'sysadmin/base.html' %}
{% load static %}
{% block title %}Availability{% endblock %}
{% block content %}
  <h2 class="page-title">Availability</h2>
  
  <!-- Date Picker -->
  <div class="date-picker-container glassmorphism">
    <label for="date-picker" class="date-picker-label">Select Date:</label>
    <input type="date" id="date-picker" value="{{ date_str }}" min="{% now 'Y-m-d' %}" class="date-picker-input">
    <small class="date-picker-hint">
      üí° You can set different availability for each date. Select a date, toggle the time slots, then select another date to set its availability.
    </small>
  </div>
  
  <section class="section">
    <div class="section-header">{{ date }}</div>
    <div class="section-body times">
      {% for slot in slots %}
      <div class="slot {% if not slot.available %}disabled{% endif %}" data-slot-id="{{ slot.id }}" data-slot="{{ slot.hour }}">
        <span>{{ slot.label }}</span>
        <div>
          {% if slot.available %}
            <span class="badge">Available</span>
          {% else %}
            <span class="badge red">Not Available</span>
          {% endif %}
          <input class="switch" type="checkbox" {% if slot.available %}checked{% endif %} data-slot-id="{{ slot.id }}">
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- Availability Summary -->
  <div class="availability-summary glassmorphism">
    <h3 class="summary-title">üìÖ Availability Summary (Next 7 Days)</h3>
    <div class="summary-grid">
      {% for day in summary_dates %}
      <div data-date="{{ day.date_str }}" class="summary-day {% if day.date == date %}current-day{% endif %}">
        <div class="day-date">{{ day.date|date:"M d" }}</div>
        <div class="day-name">{{ day.date|date:"D" }}</div>
        <div class="day-slots">
          <span class="slots-count {% if day.available_count > 0 %}available{% else %}unavailable{% endif %}">
            {{ day.available_count }}/{{ day.total_slots }} slots
          </span>
        </div>
        {% if day.date == date %}
        <div class="current-indicator">‚Üê Current</div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
    <div class="summary-hint">
      Click on any date above to set its availability, or use the date picker above.
    </div>
  </div>

  <script src="{% static 'js/availability.js' %}"></script>

  <style>
    @media (max-width: 768px) {
      .page-title {
        font-size: 1.5rem;
      }

      .date-picker-container {
        padding: 16px;
      }

      .date-picker-label {
        font-size: 0.9rem;
      }

      .date-picker-input {
        max-width: 100%;
        font-size: 0.9rem;
      }

      .date-picker-hint {
        font-size: 0.85rem;
      }

      .section-header {
        padding: 12px 16px;
        font-size: 1rem;
      }

      .slot {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
        padding: 12px;
      }

      .slot > div {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .availability-summary {
        padding: 16px;
      }

      .summary-title {
        font-size: 1.1rem;
      }

      .summary-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .summary-day {
        padding: 12px;
      }

      .day-date {
        font-size: 0.9rem;
      }

      .day-name {
        font-size: 0.75rem;
      }
    }

    @media (max-width: 480px) {
      .page-title {
        font-size: 1.3rem;
      }

      .date-picker-container {
        padding: 12px;
      }

      .date-picker-label {
        font-size: 0.85rem;
      }

      .date-picker-input {
        padding: 10px 12px;
        font-size: 0.85rem;
      }

      .date-picker-hint {
        font-size: 0.8rem;
      }

      .section-header {
        padding: 10px 14px;
        font-size: 0.95rem;
      }

      .slot {
        padding: 10px;
        gap: 8px;
      }

      .badge {
        font-size: 0.7rem;
        padding: 3px 6px;
      }

      .switch {
        width: 44px;
        height: 26px;
      }

      .switch::after {
        width: 20px;
        height: 20px;
      }

      .switch:checked::after {
        left: 20px;
      }

      .availability-summary {
        padding: 12px;
      }

      .summary-title {
        font-size: 1rem;
      }

      .summary-grid {
        grid-template-columns: 1fr;
        gap: 8px;
      }

      .summary-day {
        padding: 10px;
      }

      .day-date {
        font-size: 0.85rem;
      }

      .day-name {
        font-size: 0.7rem;
      }

      .slots-count {
        font-size: 0.75rem;
        padding: 2px 5px;
      }

      .summary-hint {
        font-size: 0.85rem;
      }
    }
  </style>
{% endblock %}


